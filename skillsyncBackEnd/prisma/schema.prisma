generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid()) @map("user_id")
  name      String
  email     String     @unique
  password  String
  role      Role
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  applicant Applicant?
  recruiter Recruiter?

  @@map("user")
}

model Recruiter {
  id          String @id @map("user_id")
  companyName String @map("company_name")
  jobs        Job[]
  user        User   @relation(fields: [id], references: [id], onDelete: Cascade)

  @@map("recruiter")
}

model Applicant {
  id        String  @id @map("user_id")
  resumeUrl String? @map("resume_url")
  user      User    @relation(fields: [id], references: [id], onDelete: Cascade)
  cvs       Cv[]

  @@map("applicant")
}

model Job {
  id             String             @id @default(uuid()) @map("job_id")
  recruiterId    String             @map("recruiter_id")
  title          String
  salary         Decimal?           @db.Decimal(10, 2)
  description    String?            @db.Text
  location       String?
  postedDate     DateTime           @default(now()) @map("posted_date")
  status         JobStatus          @default(ACTIVE)
  cvs            Cv[]
  recruiter      Recruiter          @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  qualifications JobQualification[]
  skills         JobSkill[]

  @@index([recruiterId], map: "job_description_recruiter_id_fkey")
  @@map("job_description")
}

model JobQualification {
  jobId         String @map("job_id")
  qualification String
  job           Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@id([jobId, qualification])
  @@map("job_qualification")
}

model JobSkill {
  jobId String @map("job_id")
  skill String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@id([jobId, skill])
  @@map("job_skill")
}

model Cv {
  id            String    @id @default(uuid()) @map("cv_id")
  applicantId   String    @map("applicant_id")
  jobId         String    @map("job_id")
  format        String?
  fileName      String?   @map("file_name")
  fileUrl       String?   @map("file_url")
  submittedDate DateTime  @default(now()) @map("submitted_date")
  applicant     Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  job           Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  result        Result?

    @@index([applicantId], map: "cv_applicant_id_fkey")
  @@index([jobId], map: "cv_job_id_fkey")
  @@unique([applicantId, jobId])
  @@map("cv")
}

model Result {
  id            String   @id @default(uuid()) @map("result_id")
  cvId          String   @unique @map("cv_id")
  processedDate DateTime @default(now()) @map("processed_date")
  comment       String?
  status        String?
  score         Int?
  cv            Cv       @relation(fields: [cvId], references: [id], onDelete: Cascade)

  @@map("result")
}

enum Role {
  RECRUITER
  APPLICANT
}

enum JobStatus {
  ACTIVE
  CLOSED
  DRAFT
}
